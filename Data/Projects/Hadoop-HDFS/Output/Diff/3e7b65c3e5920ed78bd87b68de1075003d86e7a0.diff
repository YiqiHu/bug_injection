diff --git a/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/lib/input/TestCombineFileInputFormat.java b/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/lib/input/TestCombineFileInputFormat.java
index 7a917faa59fb..e708f348ba27 100644
--- a/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/lib/input/TestCombineFileInputFormat.java
+++ b/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/lib/input/TestCombineFileInputFormat.java
@@ -1626,22 +1626,15 @@ public void testSplitPlacementForCompressedFiles() throws Exception {
    */
   @Test
   public void testMissingBlocks() throws Exception {
-    String namenode = null;
-    MiniDFSCluster dfs = null;
-    FileSystem fileSys = null;
-    String testName = "testMissingBlocks";
-    try {
-      Configuration conf = new Configuration();
-      conf.set("fs.hdfs.impl", MissingBlockFileSystem.class.getName());
-      conf.setBoolean("dfs.replication.considerLoad", false);
-      dfs = new MiniDFSCluster.Builder(conf).racks(rack1).hosts(hosts1)
-          .build();
+    final Configuration conf = new Configuration();
+    conf.set("fs.hdfs.impl", MissingBlockFileSystem.class.getName());
+    conf.setBoolean("dfs.replication.considerLoad", false);
+    try (MiniDFSCluster dfs = new MiniDFSCluster.Builder(conf)
+        .racks(rack1).hosts(hosts1).build()) {
       dfs.waitActive();
 
-      namenode = (dfs.getFileSystem()).getUri().getHost() + ":" +
-                 (dfs.getFileSystem()).getUri().getPort();
-
-      fileSys = dfs.getFileSystem();
+      final FileSystem fileSys =
+          MissingBlockFileSystem.newInstance(dfs.getURI(), conf);
       if (!fileSys.mkdirs(inDir)) {
         throw new IOException("Mkdirs failed to create " + inDir.toString());
       }
@@ -1673,11 +1666,6 @@ public void testMissingBlocks() throws Exception {
       assertEquals(0, fileSplit.getOffset(1));
       assertEquals(BLOCKSIZE, fileSplit.getLength(1));
       assertEquals(hosts1[0], fileSplit.getLocations()[0]);
-
-    } finally {
-      if (dfs != null) {
-        dfs.shutdown();
-      }
     }
   }
   
